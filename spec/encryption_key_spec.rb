require 'spec_helper'

describe EncryptionKey do
	it "should unlock if password is correct" do
	    data = {
	      "data"=> "U2FsdGVkX1/2nv06QLYyeKoNehrq2F3qgxobNWxPyxBWGdkpJIJxqiz9KHQtbiW2pTI1OqE3vdNLIGiclsWTx4kpke7Ww2sxt6B3gZvswruhy2ZQo0DtDzhwQA8IZMbCTvjtDkLwL8ORqwLMAzq9CFEa7ZHQ29j7Bq5zI/QfvTwMh9DLra5PojgJ1BNWagT2gdFV65JgKH68ZoKbsWJzzpYkI4osO1c5zwl3kwTNXd/09teTTV5zZfXA9ksjDwbpmsxz36w0rpPbElC0SYadJHOGZ/YttGBAp+XvMMWprDfkzd1dFVc89TIWRLUzi0zIO1sit4aoLfrPEwm0RKZAtNj8ZIXg98mBFsI3pHYMS0h0ureQ/SInwic6jNka/CYNp6PAApDvTmPI5oL7qipw2rGHjeDjJY3M8pOGJ0FT2nM6qgQKlPckNcRlRtmz02D7wLCiGIbc+yvVCHiDdpaS+WfZVf0qPcr/Ecur4bjJBuRFDcIsQgFbfXLuv9ecfXBYVgsNw79JPmNQKz39HlKF+2X3rXiQzS7WG2soHdnVK4VSZpnIGMZip1AyijtxWMRScbdt2woOTyRv3cs5asXd0ZMD+iR9h4t1V/Fl4RtwJtfBMTq/fhwv9YoFlz6FJfUd7P13CfGi0CFaU9DrmoNKu8Q3lwr03t575BHu2IkhWkSHll79H/btERZnr3IJ2rLZWdn3bh0PLnisBQ2qDQWP9DIhrHjRbW5tp1ffqXnBnndGIBi20hfJyTzimXEJZ3pIt5YfUlos09AboAqYX9DI95bEvwtxmMNNGW2/Wc5iZX9+rdQXL10wfItlbV+XUsK8RIzngGKAMuNZMcl9BQ6BU/5ravoZQgaMJZHC0cx+yJHPI1ciJr9pCss/Sqmu9agO5V0oiXSeIBZUp/X7aOat/LJBJydd0b+YFQ3Pjk9cyTYQbNQUkOZkGsUF/ykwmCI10fW9aRZ5GBZSlPqQYpK1HPYhjAELpLXsyNZ5HwEoOFVLOcLjKc4sZ6Kl0GMgz2FLM1i76lRaOToZUaRqeq8QTqL4XTvKMZhVzWF9gEtFAXtYSAoHa5mSTgpZmRtKSmyh89vjcQPEa2m+aAqf2Idx3gHgaGHw+xqoLaaBvMWBlM5mlWg1z9VNu+6VqMSS83gTm2KP5sShouHegr3PjRvDA/cROdv5WvimzJPj8p+L/UDkfeMfGcbZKc9/rsB1LYwtyLU/4ADTF3I4v963QeEh017MwFuXwmmoYv7A7GRSJ4kLETRLvhWiFjH1xohJPN6nrn/dB35SgnRNIi1XFNNb2lRKzoc3nazAJ6t7MY6H///oE2ml8WtoIxRkU14vtTZvUOdb33Pr2zNPmuANd7/xlf5WOQQwWwWbtbAovJ2SJxM9p+c7FnfMl9YR2nm10raZ\u0000",
	      "validation"=> "U2FsdGVkX1/n/cdXWqhEbKWtiJ7f9R74xSQVjqH9rAC5DvIDr8JzM0hKWuScsCaAxjmCR2nMYmkFK9OsMWSCNUFFBY+E7uXVC6amcUJIMt37jU5gvJ35zKOIoV8Wy3DxD/XXOZPL6zomgUIvqj66u8juamiuAK7uV2J+cNC/54rVuwHai7Ip/YWEyXYl/BgxmHatDUv8RExT617tWLKRObmXnEcyQq6+PttkvwDdiSsfyrzduEvVHvgFB4JJ8fNnpkgl4SQipvDymxMoBxW4IpP4ACa/qzuDwScKggJCk4bo9liSh7zW4gwV40dDdDNCwVZNhQ14AxyLlkDEhzgFq77RHnJafiekU0qm5rLn1O5U/tgjUpbbTqENv+gQBKLNb0+NHxsQ/U4PNibWHKxtS7hCjrdYUGsBGtxfdVDD8yMGH8i6dz2VnHx/l+M+PhKWBIxTWvGYCLewZg24VW0/X5IOSItbFtHu6QWqS0xUOtS9wqieBwWi2sl+nJ8E4DJryzpav68l9ejH+3tGKVZWYkzoNV+Z8hawctio/I4cfwttdAW0eRdTsrFT50dEFmfBmnW9wWYedkZpTm7liyW+5f0e5672TloEz3aMTdHW7X0TVC/gWxIQqTHXxGAp78AgwZZXcEfvChl3mLCqlhdZH+P90LyGybnaCEW3hhgsjd7Kh7e35e0A/cUcBD5nxDk7//6mltgVn0roZgCZnDnbg/u02/V3IiMeFp8Bs3AtPdyV04ZKdJrxRzObl/1URnfadwgvR42b2jRA2LqxW2TORFEwsX/TVmjxmPVvPUXsXvetd9CYO1pe1Q0nBisno1IrYtIrAT1eIsGIlLnBUhg4WEGmGTJDbWLE//fA4qP6L6HyVzkiOQQZRGg8CHc39cjcmOmyjZftKhefZB3fM0HMZOdOF9v1paOFxs+JG+p2b0fxwxJF7BFv3yXvpf25/sOBIb2WehZRInjs+2FghwAZbLj99fteb/lB1OiCBkJVM/QtW0UthtGbLuJ8OXAGHxzxLNV6BSP92FSNglU3uCbw2uQVLyhcxEJvz5+oXoHP51kB9SEhwmJbahBjGaxOpqk5gW1mrua5OiLLQcwgbND/eetBkcI4Ga3Ma+CZ4faTs74KDspSIJmc1K2fRt0OnGmF/rSM1w7eFYuYuigrQhdYU/ZQlC008QUL6HxQlLmKRW8N35O/+aRKL1qG7MnMoglqp3xaYrlaX1JYRtADCuwZiUia7YvhKL2DnlGrddThfcLYqLavqKXqVC/lTYErlVN2VKScnHG0AsgINKypVBNl0t69/jKYUsd+x4gPe1yWi/gRqqH0TBOdjWi41Bx0FNfzAZHz+J3Rf/T7OUNWibN5Sf1EqldT2ZJxeouzDVQ552VfEKUXqyQhQtBUFn4kskiy\u0000",
	      "level"=> "SL5",
	      "identifier"=> "CB7D05596E224460A6AF6B4E079A3254",
	      "iterations"=> 10000
	    }
		encryption = EncryptionKey.new data
		encryption.unlock("master-password").should be_true
	end

	it "should not unlock if password is incorrect" do
	    data = {
	      "data"=> "U2FsdGVkX1/2nv06QLYyeKoNehrq2F3qgxobNWxPyxBWGdkpJIJxqiz9KHQtbiW2pTI1OqE3vdNLIGiclsWTx4kpke7Ww2sxt6B3gZvswruhy2ZQo0DtDzhwQA8IZMbCTvjtDkLwL8ORqwLMAzq9CFEa7ZHQ29j7Bq5zI/QfvTwMh9DLra5PojgJ1BNWagT2gdFV65JgKH68ZoKbsWJzzpYkI4osO1c5zwl3kwTNXd/09teTTV5zZfXA9ksjDwbpmsxz36w0rpPbElC0SYadJHOGZ/YttGBAp+XvMMWprDfkzd1dFVc89TIWRLUzi0zIO1sit4aoLfrPEwm0RKZAtNj8ZIXg98mBFsI3pHYMS0h0ureQ/SInwic6jNka/CYNp6PAApDvTmPI5oL7qipw2rGHjeDjJY3M8pOGJ0FT2nM6qgQKlPckNcRlRtmz02D7wLCiGIbc+yvVCHiDdpaS+WfZVf0qPcr/Ecur4bjJBuRFDcIsQgFbfXLuv9ecfXBYVgsNw79JPmNQKz39HlKF+2X3rXiQzS7WG2soHdnVK4VSZpnIGMZip1AyijtxWMRScbdt2woOTyRv3cs5asXd0ZMD+iR9h4t1V/Fl4RtwJtfBMTq/fhwv9YoFlz6FJfUd7P13CfGi0CFaU9DrmoNKu8Q3lwr03t575BHu2IkhWkSHll79H/btERZnr3IJ2rLZWdn3bh0PLnisBQ2qDQWP9DIhrHjRbW5tp1ffqXnBnndGIBi20hfJyTzimXEJZ3pIt5YfUlos09AboAqYX9DI95bEvwtxmMNNGW2/Wc5iZX9+rdQXL10wfItlbV+XUsK8RIzngGKAMuNZMcl9BQ6BU/5ravoZQgaMJZHC0cx+yJHPI1ciJr9pCss/Sqmu9agO5V0oiXSeIBZUp/X7aOat/LJBJydd0b+YFQ3Pjk9cyTYQbNQUkOZkGsUF/ykwmCI10fW9aRZ5GBZSlPqQYpK1HPYhjAELpLXsyNZ5HwEoOFVLOcLjKc4sZ6Kl0GMgz2FLM1i76lRaOToZUaRqeq8QTqL4XTvKMZhVzWF9gEtFAXtYSAoHa5mSTgpZmRtKSmyh89vjcQPEa2m+aAqf2Idx3gHgaGHw+xqoLaaBvMWBlM5mlWg1z9VNu+6VqMSS83gTm2KP5sShouHegr3PjRvDA/cROdv5WvimzJPj8p+L/UDkfeMfGcbZKc9/rsB1LYwtyLU/4ADTF3I4v963QeEh017MwFuXwmmoYv7A7GRSJ4kLETRLvhWiFjH1xohJPN6nrn/dB35SgnRNIi1XFNNb2lRKzoc3nazAJ6t7MY6H///oE2ml8WtoIxRkU14vtTZvUOdb33Pr2zNPmuANd7/xlf5WOQQwWwWbtbAovJ2SJxM9p+c7FnfMl9YR2nm10raZ\u0000",
	      "validation"=> "U2FsdGVkX1/n/cdXWqhEbKWtiJ7f9R74xSQVjqH9rAC5DvIDr8JzM0hKWuScsCaAxjmCR2nMYmkFK9OsMWSCNUFFBY+E7uXVC6amcUJIMt37jU5gvJ35zKOIoV8Wy3DxD/XXOZPL6zomgUIvqj66u8juamiuAK7uV2J+cNC/54rVuwHai7Ip/YWEyXYl/BgxmHatDUv8RExT617tWLKRObmXnEcyQq6+PttkvwDdiSsfyrzduEvVHvgFB4JJ8fNnpkgl4SQipvDymxMoBxW4IpP4ACa/qzuDwScKggJCk4bo9liSh7zW4gwV40dDdDNCwVZNhQ14AxyLlkDEhzgFq77RHnJafiekU0qm5rLn1O5U/tgjUpbbTqENv+gQBKLNb0+NHxsQ/U4PNibWHKxtS7hCjrdYUGsBGtxfdVDD8yMGH8i6dz2VnHx/l+M+PhKWBIxTWvGYCLewZg24VW0/X5IOSItbFtHu6QWqS0xUOtS9wqieBwWi2sl+nJ8E4DJryzpav68l9ejH+3tGKVZWYkzoNV+Z8hawctio/I4cfwttdAW0eRdTsrFT50dEFmfBmnW9wWYedkZpTm7liyW+5f0e5672TloEz3aMTdHW7X0TVC/gWxIQqTHXxGAp78AgwZZXcEfvChl3mLCqlhdZH+P90LyGybnaCEW3hhgsjd7Kh7e35e0A/cUcBD5nxDk7//6mltgVn0roZgCZnDnbg/u02/V3IiMeFp8Bs3AtPdyV04ZKdJrxRzObl/1URnfadwgvR42b2jRA2LqxW2TORFEwsX/TVmjxmPVvPUXsXvetd9CYO1pe1Q0nBisno1IrYtIrAT1eIsGIlLnBUhg4WEGmGTJDbWLE//fA4qP6L6HyVzkiOQQZRGg8CHc39cjcmOmyjZftKhefZB3fM0HMZOdOF9v1paOFxs+JG+p2b0fxwxJF7BFv3yXvpf25/sOBIb2WehZRInjs+2FghwAZbLj99fteb/lB1OiCBkJVM/QtW0UthtGbLuJ8OXAGHxzxLNV6BSP92FSNglU3uCbw2uQVLyhcxEJvz5+oXoHP51kB9SEhwmJbahBjGaxOpqk5gW1mrua5OiLLQcwgbND/eetBkcI4Ga3Ma+CZ4faTs74KDspSIJmc1K2fRt0OnGmF/rSM1w7eFYuYuigrQhdYU/ZQlC008QUL6HxQlLmKRW8N35O/+aRKL1qG7MnMoglqp3xaYrlaX1JYRtADCuwZiUia7YvhKL2DnlGrddThfcLYqLavqKXqVC/lTYErlVN2VKScnHG0AsgINKypVBNl0t69/jKYUsd+x4gPe1yWi/gRqqH0TBOdjWi41Bx0FNfzAZHz+J3Rf/T7OUNWibN5Sf1EqldT2ZJxeouzDVQ552VfEKUXqyQhQtBUFn4kskiy\u0000",
	      "level"=> "SL5",
	      "identifier"=> "CB7D05596E224460A6AF6B4E079A3254",
	      "iterations"=> 10000
	    }
		encryption = EncryptionKey.new data
		encryption.unlock("dummy").should be_false
	end

	it "should not unlock for incorrect iterations" do
	    data = {
	      "data"=> "U2FsdGVkX1/2nv06QLYyeKoNehrq2F3qgxobNWxPyxBWGdkpJIJxqiz9KHQtbiW2pTI1OqE3vdNLIGiclsWTx4kpke7Ww2sxt6B3gZvswruhy2ZQo0DtDzhwQA8IZMbCTvjtDkLwL8ORqwLMAzq9CFEa7ZHQ29j7Bq5zI/QfvTwMh9DLra5PojgJ1BNWagT2gdFV65JgKH68ZoKbsWJzzpYkI4osO1c5zwl3kwTNXd/09teTTV5zZfXA9ksjDwbpmsxz36w0rpPbElC0SYadJHOGZ/YttGBAp+XvMMWprDfkzd1dFVc89TIWRLUzi0zIO1sit4aoLfrPEwm0RKZAtNj8ZIXg98mBFsI3pHYMS0h0ureQ/SInwic6jNka/CYNp6PAApDvTmPI5oL7qipw2rGHjeDjJY3M8pOGJ0FT2nM6qgQKlPckNcRlRtmz02D7wLCiGIbc+yvVCHiDdpaS+WfZVf0qPcr/Ecur4bjJBuRFDcIsQgFbfXLuv9ecfXBYVgsNw79JPmNQKz39HlKF+2X3rXiQzS7WG2soHdnVK4VSZpnIGMZip1AyijtxWMRScbdt2woOTyRv3cs5asXd0ZMD+iR9h4t1V/Fl4RtwJtfBMTq/fhwv9YoFlz6FJfUd7P13CfGi0CFaU9DrmoNKu8Q3lwr03t575BHu2IkhWkSHll79H/btERZnr3IJ2rLZWdn3bh0PLnisBQ2qDQWP9DIhrHjRbW5tp1ffqXnBnndGIBi20hfJyTzimXEJZ3pIt5YfUlos09AboAqYX9DI95bEvwtxmMNNGW2/Wc5iZX9+rdQXL10wfItlbV+XUsK8RIzngGKAMuNZMcl9BQ6BU/5ravoZQgaMJZHC0cx+yJHPI1ciJr9pCss/Sqmu9agO5V0oiXSeIBZUp/X7aOat/LJBJydd0b+YFQ3Pjk9cyTYQbNQUkOZkGsUF/ykwmCI10fW9aRZ5GBZSlPqQYpK1HPYhjAELpLXsyNZ5HwEoOFVLOcLjKc4sZ6Kl0GMgz2FLM1i76lRaOToZUaRqeq8QTqL4XTvKMZhVzWF9gEtFAXtYSAoHa5mSTgpZmRtKSmyh89vjcQPEa2m+aAqf2Idx3gHgaGHw+xqoLaaBvMWBlM5mlWg1z9VNu+6VqMSS83gTm2KP5sShouHegr3PjRvDA/cROdv5WvimzJPj8p+L/UDkfeMfGcbZKc9/rsB1LYwtyLU/4ADTF3I4v963QeEh017MwFuXwmmoYv7A7GRSJ4kLETRLvhWiFjH1xohJPN6nrn/dB35SgnRNIi1XFNNb2lRKzoc3nazAJ6t7MY6H///oE2ml8WtoIxRkU14vtTZvUOdb33Pr2zNPmuANd7/xlf5WOQQwWwWbtbAovJ2SJxM9p+c7FnfMl9YR2nm10raZ\u0000",
	      "validation"=> "U2FsdGVkX1/n/cdXWqhEbKWtiJ7f9R74xSQVjqH9rAC5DvIDr8JzM0hKWuScsCaAxjmCR2nMYmkFK9OsMWSCNUFFBY+E7uXVC6amcUJIMt37jU5gvJ35zKOIoV8Wy3DxD/XXOZPL6zomgUIvqj66u8juamiuAK7uV2J+cNC/54rVuwHai7Ip/YWEyXYl/BgxmHatDUv8RExT617tWLKRObmXnEcyQq6+PttkvwDdiSsfyrzduEvVHvgFB4JJ8fNnpkgl4SQipvDymxMoBxW4IpP4ACa/qzuDwScKggJCk4bo9liSh7zW4gwV40dDdDNCwVZNhQ14AxyLlkDEhzgFq77RHnJafiekU0qm5rLn1O5U/tgjUpbbTqENv+gQBKLNb0+NHxsQ/U4PNibWHKxtS7hCjrdYUGsBGtxfdVDD8yMGH8i6dz2VnHx/l+M+PhKWBIxTWvGYCLewZg24VW0/X5IOSItbFtHu6QWqS0xUOtS9wqieBwWi2sl+nJ8E4DJryzpav68l9ejH+3tGKVZWYkzoNV+Z8hawctio/I4cfwttdAW0eRdTsrFT50dEFmfBmnW9wWYedkZpTm7liyW+5f0e5672TloEz3aMTdHW7X0TVC/gWxIQqTHXxGAp78AgwZZXcEfvChl3mLCqlhdZH+P90LyGybnaCEW3hhgsjd7Kh7e35e0A/cUcBD5nxDk7//6mltgVn0roZgCZnDnbg/u02/V3IiMeFp8Bs3AtPdyV04ZKdJrxRzObl/1URnfadwgvR42b2jRA2LqxW2TORFEwsX/TVmjxmPVvPUXsXvetd9CYO1pe1Q0nBisno1IrYtIrAT1eIsGIlLnBUhg4WEGmGTJDbWLE//fA4qP6L6HyVzkiOQQZRGg8CHc39cjcmOmyjZftKhefZB3fM0HMZOdOF9v1paOFxs+JG+p2b0fxwxJF7BFv3yXvpf25/sOBIb2WehZRInjs+2FghwAZbLj99fteb/lB1OiCBkJVM/QtW0UthtGbLuJ8OXAGHxzxLNV6BSP92FSNglU3uCbw2uQVLyhcxEJvz5+oXoHP51kB9SEhwmJbahBjGaxOpqk5gW1mrua5OiLLQcwgbND/eetBkcI4Ga3Ma+CZ4faTs74KDspSIJmc1K2fRt0OnGmF/rSM1w7eFYuYuigrQhdYU/ZQlC008QUL6HxQlLmKRW8N35O/+aRKL1qG7MnMoglqp3xaYrlaX1JYRtADCuwZiUia7YvhKL2DnlGrddThfcLYqLavqKXqVC/lTYErlVN2VKScnHG0AsgINKypVBNl0t69/jKYUsd+x4gPe1yWi/gRqqH0TBOdjWi41Bx0FNfzAZHz+J3Rf/T7OUNWibN5Sf1EqldT2ZJxeouzDVQ552VfEKUXqyQhQtBUFn4kskiy\u0000",
	      "level"=> "SL5",
	      "identifier"=> "CB7D05596E224460A6AF6B4E079A3254",
	      "iterations"=> 2000
	    }
		encryption = EncryptionKey.new data
		encryption.unlock("master-password").should be_false
	end	
end