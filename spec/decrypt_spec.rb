require 'spec_helper'
require 'base64'

describe Decrypt do
	it "should decode and split salt" do
		encoded = Base64.encode64("Salted__ABCDEFGH12345678")
		decoded = Decrypt.base64_decode(encoded)
		decoded[:salt].should == "ABCDEFGH"
        decoded[:data].should == "12345678"
	end

	it "should decrypt using master password" do
		master_password = "master-password"
		data = "U2FsdGVkX1/2nv06QLYyeKoNehrq2F3qgxobNWxPyxBWGdkpJIJxqiz9KHQtbiW2pTI1OqE3vdNLIGiclsWTx4kpke7Ww2sxt6B3gZvswruhy2ZQo0DtDzhwQA8IZMbCTvjtDkLwL8ORqwLMAzq9CFEa7ZHQ29j7Bq5zI/QfvTwMh9DLra5PojgJ1BNWagT2gdFV65JgKH68ZoKbsWJzzpYkI4osO1c5zwl3kwTNXd/09teTTV5zZfXA9ksjDwbpmsxz36w0rpPbElC0SYadJHOGZ/YttGBAp+XvMMWprDfkzd1dFVc89TIWRLUzi0zIO1sit4aoLfrPEwm0RKZAtNj8ZIXg98mBFsI3pHYMS0h0ureQ/SInwic6jNka/CYNp6PAApDvTmPI5oL7qipw2rGHjeDjJY3M8pOGJ0FT2nM6qgQKlPckNcRlRtmz02D7wLCiGIbc+yvVCHiDdpaS+WfZVf0qPcr/Ecur4bjJBuRFDcIsQgFbfXLuv9ecfXBYVgsNw79JPmNQKz39HlKF+2X3rXiQzS7WG2soHdnVK4VSZpnIGMZip1AyijtxWMRScbdt2woOTyRv3cs5asXd0ZMD+iR9h4t1V/Fl4RtwJtfBMTq/fhwv9YoFlz6FJfUd7P13CfGi0CFaU9DrmoNKu8Q3lwr03t575BHu2IkhWkSHll79H/btERZnr3IJ2rLZWdn3bh0PLnisBQ2qDQWP9DIhrHjRbW5tp1ffqXnBnndGIBi20hfJyTzimXEJZ3pIt5YfUlos09AboAqYX9DI95bEvwtxmMNNGW2/Wc5iZX9+rdQXL10wfItlbV+XUsK8RIzngGKAMuNZMcl9BQ6BU/5ravoZQgaMJZHC0cx+yJHPI1ciJr9pCss/Sqmu9agO5V0oiXSeIBZUp/X7aOat/LJBJydd0b+YFQ3Pjk9cyTYQbNQUkOZkGsUF/ykwmCI10fW9aRZ5GBZSlPqQYpK1HPYhjAELpLXsyNZ5HwEoOFVLOcLjKc4sZ6Kl0GMgz2FLM1i76lRaOToZUaRqeq8QTqL4XTvKMZhVzWF9gEtFAXtYSAoHa5mSTgpZmRtKSmyh89vjcQPEa2m+aAqf2Idx3gHgaGHw+xqoLaaBvMWBlM5mlWg1z9VNu+6VqMSS83gTm2KP5sShouHegr3PjRvDA/cROdv5WvimzJPj8p+L/UDkfeMfGcbZKc9/rsB1LYwtyLU/4ADTF3I4v963QeEh017MwFuXwmmoYv7A7GRSJ4kLETRLvhWiFjH1xohJPN6nrn/dB35SgnRNIi1XFNNb2lRKzoc3nazAJ6t7MY6H///oE2ml8WtoIxRkU14vtTZvUOdb33Pr2zNPmuANd7/xlf5WOQQwWwWbtbAovJ2SJxM9p+c7FnfMl9YR2nm10raZ\u0000"
		iterations = 10000
		encrypted = "U2FsdGVkX18szXGGFR7FwBrP1w4cIk2XSlsjUlq74hAtOy7he9f/kOEpBkmCUtgu/CtkxqRF7pAfI6EDdwtH3iVj9vKHHjLyBDp5ZGlp8YiKbjXVZCzysqGryiqwx7whZBcn/Kso1vw/uWtF6YYxjnWhX8mVFC9S9BcXrJMBq8bGGMWdlmPFREJ998vhkLSE2/pIycocThDdR5wNLeQMemIarB8kRLICeoNwqUOlPpyIIa/soZqN1Nbn/aKWhBPkNgYV/x8+L4/R7blXzHINedeS1HuojFnBy7b3vRvYFM40jXTAMAsYyuRUKXolP+APTwXM29z/PzNbLXXzcojGuHcZbffdUovUZuT9cUBAB7Oefwmlq6jU07wj9KpywW/x3VWUYY7Q3aixsmmD3WDJz4pMcqSzF/rtcLBC6IqG9/s=\u0000"

		master_key = Decrypt.decrypt_pbkdf2(master_password, data, iterations)
		key = JSON.parse Decrypt.decrypt_ssl(master_key, encrypted)
		key['fields'].select {|f| f['name'] == "Password"}.first['value'].should == "my-password"
	end
end